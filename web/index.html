<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find Your Group</title>

  <style>
    :root {
      --bg: #f6f8fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --primary: #2563eb;
      --primary-soft: #e0e7ff;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
  margin: 0;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: radial-gradient(1200px 600px at 50% 10%, #eef2ff, #f6f8fb);
  color: var(--text);

  /* iPad/projector-friendly: not dead-center */
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 48px 20px;
}

    .app {
  width: 100%;
  max-width: 520px; /* bigger card on tablets */
}

    .card {
  background: var(--card);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 28px;
  overflow: hidden; /* <-- stops iPad date control from visually bleeding */
  
}

    h1 {
      font-size: 1.6rem;
      margin: 0 0 6px 0;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 24px;
    }

    label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .field {
  width: 100%;
}

/* This is important: makes widths behave predictably everywhere */
*, *::before, *::after {
  box-sizing: border-box;
}

.card {
  padding: 28px;
  overflow: hidden; /* keep Safari honest */
}

/* Wrapper defines the geometry */
.field {
  width: 100%;
  padding: 0;
  margin: 0;
}

.field input[type="date"] {
  height: 56px;              
  font-size: 1.2rem;        
  padding: 0 16px;           
  line-height: normal;

  width: 100%;
  box-sizing: border-box;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  background: #fff;

}

.field input[type="date"] {
  padding-right: 22px;
}

    button {
      width: 100%;
      margin-top: 16px;
      padding: 14px 16px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 14px;
      border: none;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.05s ease;
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.35);
    }

    button:active {
      transform: translateY(1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .status {
      margin-top: 14px;
      text-align: center;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .results {
      margin-top: 20px;
      display: grid;
      gap: 12px;
    }

    .result-card {
      background: #f8fafc;
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .name {
      font-weight: 600;
    }

    .group {
      font-size: 0.85rem;
      background: var(--primary-soft);
      color: var(--primary);
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 600;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <main class="app">
    <section class="card">
      <h1>Find your group</h1>
      <div class="subtitle">Select your date of birth</div>

      <label for="dob">Date of birth</label>
      <div class="field">
  <input id="dob" type="date" />
</div>

      <button id="go">Find my group</button>

      <div id="status" class="status"></div>

      <div id="results" class="results"></div>
    </section>
  </main>

  <script>
    const LOOKUP_URL = "https://mtexrmbrtoiyqjmdjtow.supabase.co/functions/v1/lookup";

    const dobInput = document.getElementById("dob");
    const goBtn = document.getElementById("go");
    const statusEl = document.getElementById("status");
    const resultsEl = document.getElementById("results");

    function setStatus(msg) {
      statusEl.textContent = msg || "";
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    async function lookup() {
      const dob = dobInput.value;
      resultsEl.innerHTML = "";
      if (!dob) {
        setStatus("Please select your date of birth.");
        return;
      }

      setStatus("Looking up your groupâ€¦");

      try {
        const res = await fetch(LOOKUP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ dob })
        });

        const data = await res.json();
        if (!res.ok || !data.ok) {
          setStatus(data.message || "Something went wrong.");
          return;
        }

        if (!data.matches.length) {
          setStatus("No match found.");
          return;
        }

        setStatus(`Found ${data.matches.length} result${data.matches.length > 1 ? "s" : ""}`);

        resultsEl.innerHTML = data.matches.map(m => `
          <div class="result-card">
            <div class="name">${escapeHtml(m.name)}</div>
            <div class="group">Group ${escapeHtml(m.group_id)}</div>
          </div>
        `).join("");
      } catch {
        setStatus("Network error. Please try again.");
      }
    }

    goBtn.addEventListener("click", lookup);
    dobInput.addEventListener("change", () => setStatus(""));
  </script>
</body>
</html>
